"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var i=e(t),a=0;a<i.length;a++)"default"!==i[a]&&__createBinding(r,t,i[a]);return __setModuleDefault(r,t),r}}(),__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(a,n){function o(e){try{s(i.next(e))}catch(e){n(e)}}function d(e){try{s(i.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,d)}s((i=i.apply(e,t||[])).next())})},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.gdFlixExtracter=gdFlixExtracter;const axios_1=__importDefault(require("axios")),cheerio=__importStar(require("cheerio")),headers_1=require("./headers");function gdFlixExtracter(e,t){return __awaiter(this,void 0,void 0,function*(){var r,i,a,n,o,d,s;try{const l=[],c=(yield(0,axios_1.default)(`${e}`,{headers:headers_1.headers,signal:t})).data;let u=cheerio.load(c);if(null===(r=u("body").attr("onload"))||void 0===r?void 0:r.includes("location.replace")){const e=null===(n=null===(a=null===(i=u("body").attr("onload"))||void 0===i?void 0:i.split("location.replace('"))||void 0===a?void 0:a[1].split("'"))||void 0===n?void 0:n[0];if(e){const r=yield axios_1.default.get(e,{headers:headers_1.headers,signal:t});u=cheerio.load(r.data)}}try{const t=e.split("/").slice(0,3).join("/"),r=u(".btn-secondary").attr("href")||"";if(r.includes("indexbot")){const e=yield axios_1.default.get(r,{headers:headers_1.headers}),t=e.data.match(/formData\.append\('token', '([a-f0-9]+)'\)/)[1],i=new FormData;i.append("token",t);const a=e.data.match(/fetch\('\/download\?id=([a-zA-Z0-9\/+]+)'/)[1],n=r.split("/download")[0],o=yield fetch(n+"/download?id="+a,{method:"POST",body:i,headers:{Referer:r,Cookie:"PHPSESSID=7e9658ce7c805dab5bbcea9046f7f308"}}),d=yield o.json();l.push({server:"ResumeBot",link:d.url,type:"mkv"})}else{const e=t+r,i=(yield axios_1.default.get(e,{headers:headers_1.headers})).data,a=cheerio.load(i)(".btn-success").attr("href");a&&l.push({server:"ResumeCloud",link:a,type:"mkv"})}}catch(e){}try{const e=u(".btn-danger").attr("href")||"";if(e.includes("?url=")){const t=e.split("=")[1],r=new FormData;r.append("keys",t);const i=e.split("/").slice(0,3).join("/")+"/api",a=yield fetch(i,{method:"POST",body:r,headers:{"x-token":i}}),n=yield a.json();if(!1===n.error){const e=n.url;l.push({server:"Gdrive-Instant",link:e,type:"mkv"})}}else{const r=(null===(s=null===(d=null===(o=(yield axios_1.default.head(e,{headers:headers_1.headers,signal:t})).request)||void 0===o?void 0:o.responseURL)||void 0===d?void 0:d.split("?url="))||void 0===s?void 0:s[1])||e;l.push({server:"G-Drive",link:r,type:"mkv"})}}catch(e){}return l}catch(e){return[]}})}