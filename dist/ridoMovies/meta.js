"use strict";var __awaiter=this&&this.__awaiter||function(i,e,t,n){return new(t||(t=Promise))(function(o,l){function s(i){try{a(n.next(i))}catch(i){l(i)}}function d(i){try{a(n.throw(i))}catch(i){l(i)}}function a(i){var e;i.done?o(i.value):(e=i.value,e instanceof t?e:new t(function(i){i(e)})).then(s,d)}a((n=n.apply(i,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const getMeta=function(i){return __awaiter(this,arguments,void 0,function*({link:i,providerContext:e}){var t,n,o,l,s,d,a;try{const{getBaseUrl:u,axios:v}=e,r=(yield v.get(i)).data,c={title:"",synopsis:"",image:"",imdbId:(null===(t=null==r?void 0:r.meta)||void 0===t?void 0:t.imdb_id)||"",type:(null===(n=null==r?void 0:r.meta)||void 0===n?void 0:n.type)||"movie"},p=yield u("ridomovies");let m="";try{const i=(yield v.get(p+"/core/api/search?q="+c.imdbId)).data;if(m=null===(l=null===(o=null==i?void 0:i.data)||void 0===o?void 0:o.items[0])||void 0===l?void 0:l.fullSlug,!m||"series"===(null==c?void 0:c.type))return{title:"",synopsis:"",image:"",imdbId:(null===(s=null==r?void 0:r.meta)||void 0===s?void 0:s.imdb_id)||"",type:(null==c?void 0:c.type)||"movie",linkList:[]}}catch(i){return{title:"",synopsis:"",image:"",imdbId:(null==c?void 0:c.imdbId)||"",type:(null==c?void 0:c.type)||"movie",linkList:[]}}const y=[];let f=[],g=new Map;if("series"===c.type){null===(a=null===(d=null==r?void 0:r.meta)||void 0===d?void 0:d.videos)||void 0===a||a.map(i=>{(null==i?void 0:i.season)<=0||(g.has(null==i?void 0:i.season)||g.set(null==i?void 0:i.season,[]),g.get(null==i?void 0:i.season).push({title:"Episode "+(null==i?void 0:i.episode),link:""}))});for(const[i,e]of g.entries())y.push({title:"Season "+i,directLinks:e})}else f.push({title:"Movie",link:i}),y.push({title:"Movie",directLinks:f});return Object.assign(Object.assign({},c),{linkList:y})}catch(i){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]}}})};exports.getMeta=getMeta;