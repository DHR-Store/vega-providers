"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))(function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,s)}c((a=a.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=t=>__awaiter(void 0,[t],void 0,function*({link:t,providerContext:e}){var r,a;try{const{cheerio:n,commonHeaders:i,axios:o}=e,s=JSON.parse(t),c=[],l=(null==s?void 0:s.baseUrl)+"/api/"+(null==s?void 0:s.slug),u=yield o.get(l,{headers:i}),d=(null===(a=null===(r=u.data.data)||void 0===r?void 0:r[0])||void 0===a?void 0:a.url).split('src="')[1].split('"')[0],p=yield o.get(d,{headers:Object.assign(Object.assign({},i),{Referer:null==s?void 0:s.baseUrl})}),v=n.load(p.data)('script:contains("eval")').html();if(!v)throw new Error("Unable to find script");const h=unpackJavaScript(v.trim());return c.push({link:h,server:"rido",type:"m3u8",headers:{Referer:d}}),c}catch(t){return[]}});function unpackJavaScript(t){const e=t.split("|aHR")[1].split("|")[0];var r;return atob((r="aHR"+e)+"=".repeat((4-r.length%4)%4))}exports.getStream=getStream;