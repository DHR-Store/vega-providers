"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const headers={Referer:"https://google.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"},getMeta=function(_a){return __awaiter(this,arguments,void 0,function*({link:link,providerContext:providerContext}){var _b,_c,_d;try{const{axios:axios,cheerio:cheerio}=providerContext,res=yield axios.get(link,{headers:headers}),$=cheerio.load(res.data),container=$("article, .entry-content").first();const title=(container.find("h1.entry-title").first().text().trim()||(null===(_b=$("meta[property='og:title']").attr("content"))||void 0===_b?void 0:_b.trim())||$("title").text().trim()).replace(/PikaHD/gi,"").replace(/\[.*?\]/g,"").replace(/\(.+?\)/g,"").replace(/\s{2,}/g," ").trim(),type=/season|episode|ep\s*\d+/i.test(title)?"series":"movie",synopsis=container.find("p").map((_,el)=>$(el).text().trim()).get().join(" ")||$("meta[name='description']").attr("content")||$("meta[property='og:description']").attr("content")||"";let image=$("meta[property='og:image']").attr("content")||container.find("img.wp-post-image").attr("src")||container.find("img").first().attr("src")||"";image.startsWith("/")&&(image=`https://pikahd.eu${image}`);const imdbId=(null===(_d=null===(_c=$('a[href*="imdb.com/title/tt"]',container).attr("href"))||void 0===_c?void 0:_c.match(/tt\d+/))||void 0===_d?void 0:_d[0])||"",links=[],streamLinks=[],downloadLinks=[],seenLinks=new Set;$('a:contains("Episode"), a:contains("EP"), .episodelist a, ul li a',container).each((_,el)=>{const epTitle=$(el).text().trim(),epLink=$(el).attr("href");if(!epLink)return;const finalLink=epLink.startsWith("http")?epLink:new URL(epLink,link).href;if(seenLinks.has(finalLink))return;seenLinks.add(finalLink);const numberMatch=epTitle.match(/(\d+)/),fullTitle=`Episode ${numberMatch?numberMatch[0]:"Unknown"} - ${title}`;streamLinks.push({title:fullTitle,link:finalLink,type:"episode"})}),container.find("a").each((_,el)=>{var _a;const linkText=$(el).text().trim(),href=$(el).attr("href");if(!href)return;const finalLink=href.startsWith("http")?href:new URL(href,link).href;seenLinks.has(finalLink)||(/download/i.test(linkText)?(seenLinks.add(finalLink),downloadLinks.push({title:linkText||"Download",link:finalLink,type:"movie"})):(/480|720|1080|2160|4K|mp4|m3u8/i.test(linkText)||/\.(mp4|m3u8)$/i.test(finalLink))&&(seenLinks.add(finalLink),streamLinks.push({title:linkText||"Stream",link:finalLink,type:"movie",quality:(null===(_a=linkText.match(/\b(480p|720p|1080p|2160p|4K)\b/i))||void 0===_a?void 0:_a[0])||""})))});const scriptData=$("script",container).map((_,el)=>$(el).html()).get().join(" ");return[...scriptData.matchAll(/https?:\/\/[^\s'"]+\.(mp4|m3u8)/gi)].forEach(m=>{seenLinks.has(m[0])||(seenLinks.add(m[0]),streamLinks.push({title:"Stream Link",link:m[0],type:"movie"}))}),$("iframe",container).each((_,el)=>{const src=$(el).attr("src");if(!src)return;const finalLink=src.startsWith("http")?src:new URL(src,link).href;seenLinks.has(finalLink)||(seenLinks.add(finalLink),streamLinks.push({title:"Iframe Stream",link:finalLink,type:"movie"}))}),links.push({title:title||"Episodes / Stream",directLinks:streamLinks||[]}),links.push({title:title||"Download Links",directLinks:downloadLinks||[]}),{title:title,synopsis:synopsis,image:image,imdbId:imdbId,type:type,linkList:links||[]}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]}}})};exports.getMeta=getMeta;