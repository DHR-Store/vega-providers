"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const headers={Referer:"https://google.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"},getMeta=async function({link:link,providerContext:providerContext}){var _a,_b,_c;try{const{axios:axios,cheerio:cheerio}=providerContext,res=await axios.get(link,{headers:headers}),$=cheerio.load(res.data),container=$("article, .entry-content").first();let rawTitle=container.find("h1.entry-title").first().text().trim()||(null===(_a=$("meta[property='og:title']").attr("content"))||void 0===_a?void 0:_a.trim())||$("title").text().trim();const title=rawTitle.replace(/PikaHD/gi,"").replace(/\[.*?\]/g,"").replace(/\(.+?\)/g,"").replace(/\s{2,}/g," ").trim(),type=/season|episode|ep\s*\d+/i.test(rawTitle)?"series":"movie",synopsis=$('h2:contains("Storyline")').next("p").text().trim()||$("meta[name='description']").attr("content")||$("meta[property='og:description']").attr("content")||"";let image=$("meta[property='og:image']").attr("content")||container.find("img[fetchpriority='high']").attr("src")||container.find("img").first().attr("src")||"";image.startsWith("/")&&(image=`https://pikahd.eu${image}`);const imdbId=(null===(_c=null===(_b=$('a[href*="imdb.com/title/tt"]',container).attr("href"))||void 0===_b?void 0:_b.match(/tt\d+/))||void 0===_c?void 0:_c[0])||"",links=[],seenLinks=new Set,episodeNumberMatch=rawTitle.match(/Episode\s*(\d+)/i),seasonNumberMatch=rawTitle.match(/S(\d+)/i);let episodeNumber=episodeNumberMatch?episodeNumberMatch[1]:"Unknown",seasonNumber=seasonNumberMatch?seasonNumberMatch[1]:"Unknown";const episodeLinks=[];return $("iframe",container).each((_,el)=>{const src=$(el).attr("src");if(!src)return;const finalLink=src.startsWith("http")?src:new URL(src,link).href;seenLinks.has(finalLink)||(seenLinks.add(finalLink),episodeLinks.push({title:`Main Stream (Season ${seasonNumber}, Episode ${episodeNumber})`,link:finalLink}))}),container.find('h3 a[href*="links.kmhd.net"]').each((_,el)=>{const href=$(el).attr("href");if(!href)return;const finalLink=href.startsWith("http")?href:new URL(href,link).href;if(seenLinks.has(finalLink))return;seenLinks.add(finalLink);const linkText=$(el).text().trim(),epMatch=linkText.match(/E(\d+)/i),qualityMatch=linkText.match(/(1080p|720p|480p)/i);episodeNumber=epMatch?epMatch[1]:episodeNumber;const quality=qualityMatch?qualityMatch[0]:"HD";episodeLinks.push({title:`Season ${seasonNumber}, Episode ${episodeNumber} (${quality})`,link:finalLink,quality:quality})}),episodeLinks.length>0&&links.push({title:"Episodes",directLinks:episodeLinks}),{title:title,synopsis:synopsis,image:image,imdbId:imdbId,type:type,linkList:links||[]}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]}}};exports.getMeta=getMeta;