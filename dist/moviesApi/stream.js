"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function c(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(c,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mpGetStream=void 0;const mpGetStream=function(e){return __awaiter(this,arguments,void 0,function*({link:e,type:t,providerContext:i}){var n,r;try{const{getBaseUrl:o,cheerio:c}=i,a=[],{season:l,episode:s,tmdbId:d}=JSON.parse(e),u=yield o("moviesapi"),p="movie"===t?`${u}/movie/${d}`:`${u}/tv/${d}-${l}-${s}`,h=yield fetch(p,{headers:{referer:u}}),v=yield h.text(),m=c.load(v)("iframe").attr("src")||"",f=yield fetch(m,{credentials:"omit",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:101.0) Gecko/20100101 Firefox/101.0",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5","Alt-Used":"w1.moviesapi.club","Upgrade-Insecure-Requests":"1","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1",Pragma:"no-cache","Cache-Control":"no-cache",referer:u},referrer:u,method:"GET",mode:"cors"}),x=(null===(n=(yield f.text()).match(/const\s+Encrypted\s*=\s*['"]({.*})['"]/))||void 0===n?void 0:n[1])||"";if(m){const e=yield fetch("https://ext.8man.me/api/decrypt?passphrase==JV[t}{trEV=Ilh5",{method:"POST",body:x}),t=yield e.json(),i=null===(r=null==t?void 0:t.subtitles)||void 0===r?void 0:r.map(e=>{var t;return{title:(null==e?void 0:e.label)||"Unknown",language:null==e?void 0:e.label,type:(null===(t=null==e?void 0:e.file)||void 0===t?void 0:t.includes(".vtt"))?"text/vtt":"application/x-subrip",uri:null==e?void 0:e.file}});a.push({server:"vidstreaming ",type:"m3u8",subtitles:i,link:null==t?void 0:t.videoUrl,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:101.0) Gecko/20100101 Firefox/101.0",Referer:u,Origin:u,Accept:"*/*","Accept-Language":"en-US,en;q=0.5","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"cross-site",Pragma:"no-cache","Cache-Control":"no-cache"}})}return a}catch(e){return[]}})};exports.mpGetStream=mpGetStream;