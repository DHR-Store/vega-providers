"use strict";var __awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(o,r){function n(e){try{d(i.next(e))}catch(e){r(e)}}function c(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(n,c)}d((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Cache-Control":"no-store","Accept-Language":"en-US,en;q=0.9",DNT:"1","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Microsoft Edge";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate",Cookie:"popads_user_id=6ba8fe60a481387a3249f05aa058822d","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0"},getStream=function(e){return __awaiter(this,arguments,void 0,function*({link:e,type:t,providerContext:a}){var i,o;const{axios:r,cheerio:n}=a;try{const c=function(e){return __awaiter(this,arguments,void 0,function*({url:e,providerContext:t}){var a;const{axios:i,cheerio:o}=t;try{e.includes("url=")&&(e=atob(e.split("url=")[1]));const t=(yield i.get(e)).data;let r=o.load(t);if(e.includes("url=")){const t=null===(a=r("meta[http-equiv='refresh']").attr("content"))||void 0===a?void 0:a.split("url=")[1],n=(yield i.get(t||e)).data;r=o.load(n)}const n=[];return r("h3,h4").map((e,t)=>{const a=r(t).text(),i=r(t).find("a").attr("href");i&&"#"!==i&&n.push({title:a.trim()||"No title found",link:i||""})}),r("a.maxbutton").map((e,t)=>{const a=r(t).children("span").text(),i=r(t).attr("href");i&&"#"!==i&&n.push({title:a.trim()||"No title found",link:i||""})}),n}catch(e){return[]}})};if("movie"===t){e=(yield c({url:e,providerContext:a}))[0].link||e}let d=yield modExtractor(e,a);const s=(null===(o=null===(i=null==d?void 0:d.data)||void 0===i?void 0:i.match(/content="0;url=(.*?)"/))||void 0===o?void 0:o[1])||e,l=[],h=yield isDriveLink(s),p=(yield r.get(h,{headers:headers})).data,u=n.load(p);try{const e=u(".btn.btn-light").attr("href")||"",t=yield r.get(e,{headers:headers}),a=t.data.match(/formData\.append\('token', '([a-f0-9]+)'\)/)[1],i=new FormData;i.append("token",a);const o=t.data.match(/fetch\('\/download\?id=([a-zA-Z0-9\/+]+)'/)[1],n=e.split("/download")[0],c=yield fetch(n+"/download?id="+o,{method:"POST",body:i,headers:{Referer:e,Cookie:"PHPSESSID=7e9658ce7c805dab5bbcea9046f7f308"}}),d=yield c.json();l.push({server:"ResumeBot",link:d.url,type:"mkv"})}catch(e){}try{const e=h.replace("/file","/wfile")+"?type=1",t=(yield r.get(e,{headers:headers})).data,a=n.load(t);a(".btn-success").each((e,t)=>{var a;const i=null===(a=t.attribs)||void 0===a?void 0:a.href;i&&l.push({server:"Cf Worker 1."+e,link:i,type:"mkv"})})}catch(e){}try{const e=h.replace("/file","/wfile")+"?type=2",t=(yield r.get(e,{headers:headers})).data,a=n.load(t);a(".btn-success").each((e,t)=>{var a;const i=null===(a=t.attribs)||void 0===a?void 0:a.href;i&&l.push({server:"Cf Worker 2."+e,link:i,type:"mkv"})})}catch(e){}try{const e=u(".btn-danger").attr("href")||"",t=e.split("=")[1],a=new FormData;a.append("keys",t);const i=e.split("/").slice(0,3).join("/")+"/api",o=yield fetch(i,{method:"POST",body:a,headers:{"x-token":i}}),r=yield o.json();if(!1===r.error){const e=r.url;l.push({server:"Gdrive-Instant",link:e,type:"mkv"})}}catch(e){}return l}catch(e){return[]}})};exports.getStream=getStream;const isDriveLink=e=>__awaiter(void 0,void 0,void 0,function*(){if(e.includes("drive")){const t=yield fetch(e),a=(yield t.text()).match(/window\.location\.replace\("([^"]+)"\)/),i=null==a?void 0:a[1];return`https://${e.split("/")[2]}${i}`}return e});function modExtractor(e,t){return __awaiter(this,void 0,void 0,function*(){const{axios:a,cheerio:i}=t;try{const t=e.split("sid=")[1];var o=new FormData;o.append("_wp_http",t);const n=yield fetch(e.split("?")[0],{method:"POST",body:o}),c=yield n.text(),d=i.load(c),s=d("input").attr("name","_wp_http2").val();var r=new FormData;r.append("_wp_http2",s);const l=d("form").attr("action")||e.split("?")[0],h=yield fetch(l,{method:"POST",body:r}),p=(yield h.text()).match(/setAttribute\("href",\s*"(.*?)"/)[1],u=p.split("=")[1];return yield a.get(p,{headers:{Referer:l,Cookie:`${u}=${s}`}})}catch(e){}})}