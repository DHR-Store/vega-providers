"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,c)}s((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Cache-Control":"no-store","Accept-Language":"en-US,en;q=0.9",DNT:"1","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Microsoft Edge";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0"},getStream=e=>__awaiter(void 0,[e],void 0,function*({link:e,providerContext:t}){var i,r;try{const{axios:a,cheerio:o}=t;let n=yield modExtractor(e,t);const c=(null===(r=null===(i=null==n?void 0:n.data)||void 0===i?void 0:i.match(/content="0;url=(.*?)"/))||void 0===r?void 0:r[1])||e,s=yield isDriveLink(c),d=[],l=(yield a.get(s,{headers:headers})).data,h=o.load(l);try{const e=h(".btn-danger").attr("href")||"",t=e.split("=")[1],i=new FormData;i.append("keys",t);const r=e.split("/").slice(0,3).join("/")+"/api",a=yield fetch(r,{method:"POST",body:i,headers:{"x-token":r}}),o=yield a.json();if(!1===o.error){const e=o.url;d.push({server:"Gdrive-Instant",link:e,type:"mkv"})}}catch(e){}try{const e=s.replace("/file","/zfile"),t=(yield a.get(e,{headers:headers})).data,i=o.load(t)(".btn-success").attr("href");i&&d.push({server:"ResumeCloud",link:i,type:"mkv"})}catch(e){}try{const e=s.replace("/file","/wfile")+"?type=1",t=(yield a.get(e,{headers:headers})).data,i=o.load(t);i(".btn-success").each((e,t)=>{var i;const r=null===(i=t.attribs)||void 0===i?void 0:i.href;r&&d.push({server:"Cf Worker 1."+e,link:r,type:"mkv"})})}catch(e){}try{const e=s.replace("/file","/wfile")+"?type=2",t=(yield a.get(e,{headers:headers})).data,i=o.load(t);i(".btn-success").each((e,t)=>{var i;const r=null===(i=t.attribs)||void 0===i?void 0:i.href;r&&d.push({server:"Cf Worker 2."+e,link:r,type:"mkv"})})}catch(e){}return d}catch(e){return[]}});exports.getStream=getStream;const isDriveLink=e=>__awaiter(void 0,void 0,void 0,function*(){if(e.includes("drive")){const t=yield fetch(e),i=(yield t.text()).match(/window\.location\.replace\("([^"]+)"\)/),r=null==i?void 0:i[1];return`https://${e.split("/")[2]}${r}`}return e});function modExtractor(e,t){return __awaiter(this,void 0,void 0,function*(){const{axios:i,cheerio:r}=t;try{const t=e.split("sid=")[1];var a=new FormData;a.append("_wp_http",t);const n=yield fetch(e.split("?")[0],{method:"POST",body:a}),c=yield n.text(),s=r.load(c),d=s("input").attr("name","_wp_http2").val();var o=new FormData;o.append("_wp_http2",d);const l=s("form").attr("action")||e.split("?")[0],h=yield fetch(l,{method:"POST",body:o}),p=(yield h.text()).match(/setAttribute\("href",\s*"(.*?)"/)[1],u=p.split("=")[1];return yield i.get(p,{headers:{Referer:l,Cookie:`${u}=${d}`}})}catch(e){}})}