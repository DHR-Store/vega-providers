"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=async function({link:url,providerContext:providerContext}){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m;const{axios:axios,cheerio:cheerio}=providerContext,headers={"sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Microsoft Edge";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',Referer:"https://multimovies.gofl/","Sec-Fetch-User":"?1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0"};try{const html=(await axios.get(url,{headers:headers})).data,$=cheerio.load(html),streamLinks=[],postId=$("#player-option-1").attr("data-post"),nume=$("#player-option-1").attr("data-nume"),typeValue=$("#player-option-1").attr("data-type"),baseUrl=url.split("/").slice(0,3).join("/"),formData=new FormData;formData.append("action","doo_player_ajax"),formData.append("post",postId||""),formData.append("nume",nume||""),formData.append("type",typeValue||"");const playerRes=await fetch(`${baseUrl}/wp-admin/admin-ajax.php`,{headers:headers,body:formData,method:"POST"}),playerData=await playerRes.json();let ifameUrl=(null===(_b=null===(_a=null==playerData?void 0:playerData.embed_url)||void 0===_a?void 0:_a.match(/<iframe[^>]+src="([^"]+)"[^>]*>/i))||void 0===_b?void 0:_b[1])||(null==playerData?void 0:playerData.embed_url);if(!ifameUrl.includes("multimovies")){let playerBaseUrl=ifameUrl.split("/").slice(0,3).join("/");const newPlayerBaseUrl=await axios.head(playerBaseUrl,{headers:headers});(null===(_c=null==newPlayerBaseUrl?void 0:newPlayerBaseUrl.request)||void 0===_c?void 0:_c.responseURL)&&(playerBaseUrl=null===(_e=null===(_d=newPlayerBaseUrl.request)||void 0===_d?void 0:_d.responseURL)||void 0===_e?void 0:_e.split("/").slice(0,3).join("/")),(null===(_f=null==newPlayerBaseUrl?void 0:newPlayerBaseUrl.request)||void 0===_f?void 0:_f.responseURL)||(playerBaseUrl=null===(_g=(await axios.head(playerBaseUrl,{headers:headers,maxRedirects:0,validateStatus:status=>status>=200&&status<400})).headers)||void 0===_g?void 0:_g.location);const playerId=ifameUrl.split("/").pop(),NewformData=new FormData;NewformData.append("sid",playerId);const playerRes=await fetch(`${playerBaseUrl}/embedhelper.php`,{headers:headers,body:NewformData,method:"POST"}),playerData=await playerRes.json(),siteUrl=null===(_h=null==playerData?void 0:playerData.siteUrls)||void 0===_h?void 0:_h.smwh,newIframeUrl=siteUrl+((null===(_j=JSON.parse(atob(null==playerData?void 0:playerData.mresult)))||void 0===_j?void 0:_j.smwh)||(null===(_k=null==playerData?void 0:playerData.mresult)||void 0===_k?void 0:_k.smwh));newIframeUrl&&(ifameUrl=newIframeUrl)}const iframeData=(await axios.get(ifameUrl,{headers:{...headers,Referer:url}})).data;var match=/eval\(function\((.*?)\)\{.*?return p\}.*?\('(.*?)'\.split/.exec(iframeData);let p="";if(match){var encodedString=match[2];p=null===(_l=encodedString.split("',36,"))||void 0===_l?void 0:_l[0].trim();let a=36,c=encodedString.split("',36,")[1].slice(2).split("|").length,k=encodedString.split("',36,")[1].slice(2).split("|");for(;c--;)if(k[c]){var regex=new RegExp("\\b"+c.toString(a)+"\\b","g");p=p.replace(regex,k[c])}}const streamUrl=null===(_m=null==p?void 0:p.match(/https?:\/\/[^"]+?\.m3u8[^"]*/))||void 0===_m?void 0:_m[0],subtitles=[],subtitleMatch=null==p?void 0:p.match(/https:\/\/[^\s"]+\.vtt/g);return(null==subtitleMatch?void 0:subtitleMatch.length)&&subtitleMatch.forEach(sub=>{const lang=sub.match(/_([a-zA-Z]{3})\.vtt$/)[1];subtitles.push({language:lang,uri:sub,type:"text/vtt",title:lang})}),streamUrl&&streamLinks.push({server:"Multi",link:streamUrl.replace(/&i=\d+,'\.4&/,"&i=0.4&"),type:"m3u8",subtitles:[]}),streamLinks}catch(err){return[]}};exports.getStream=getStream;