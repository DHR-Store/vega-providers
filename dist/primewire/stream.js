"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function c(e){try{s(i.next(e))}catch(e){o(e)}}function a(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=function(e){return __awaiter(this,arguments,void 0,function*({link:e,type:t,providerContext:n}){var i,r,o,c,a,s;const{axios:l,cheerio:p}=n;try{const t=e.split("/").slice(0,3).join("/"),n=[],h=[],f=(yield l.get(e)).data,m=p.load(f);m('tr:contains("mixdrop")').map((e,n)=>{const i=m(n).find(".wp-menu-btn").attr("data-wp-menu"),r=m(n).find(".wp-menu-btn").next().text();i&&h.push({id:t+"/links/go/"+i,size:r})});for(const e of h){const t=yield l.head(e.id),p=null===(i=t.request)||void 0===i?void 0:i.responseURL.replace("/f/","/e/"),h=yield fetch(p,{credentials:"include",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:101.0) Gecko/20100101 Firefox/101.0",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5","Upgrade-Insecure-Requests":"1","Sec-Fetch-Dest":"iframe","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"same-origin",Pragma:"no-cache","Cache-Control":"no-cache",referer:null===(r=t.request)||void 0===r?void 0:r.responseURL},referrer:null===(o=t.request)||void 0===o?void 0:o.responseURL,method:"GET",mode:"cors"}),f=yield h.text();var u=/eval\(function\((.*?)\)\{.*?return p\}.*?\('(.*?)'\.split/.exec(f);let m="";if(u){var d=u[2];const i=Number(d.split(",'|MDCore|")[0].split(",")[d.split(",'|MDCore|")[0].split(",").length-1]);m=null===(c=d.split(`',${i},`))||void 0===c?void 0:c[0].trim();let r=i,o=d.split(`',${i},`)[1].slice(2).split("|").length,l=d.split(`',${i},`)[1].slice(2).split("|");const p=function(e,t,n,i,r,o){if(r=function(e){return e.toString(36)},!"".replace(/^/,String)){for(;n--;)o[n.toString(t)]=i[n]||n.toString(t);i=[function(e){return o[e]}],r=function(){return"\\w+"},n=1}for(;n--;)i[n]&&(e=e.replace(new RegExp("\\b"+r(n)+"\\b","g"),i[n]));return e},h=p(m,r,o,l,0,{}),f="https:"+(null===(a=h.match(/MDCore\.wurl="([^"]+)"/))||void 0===a?void 0:a[1]);n.push({server:"Mixdrop "+e.size,link:f,type:"mp4",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:101.0) Gecko/20100101 Firefox/101.0",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5","Upgrade-Insecure-Requests":"1","Sec-Fetch-Dest":"iframe","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"same-origin",Pragma:"no-cache","Cache-Control":"no-cache",referer:null===(s=t.request)||void 0===s?void 0:s.responseURL}})}}return n}catch(e){return[]}})};exports.getStream=getStream;