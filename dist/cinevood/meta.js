"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const getMeta=async function({link:link,providerContext:providerContext,rawHtml:rawHtml}){try{const{axios:axios,cheerio:cheerio}=providerContext;let html;if(rawHtml&&rawHtml.trim().length>0)html=rawHtml;else{const res=await axios.get(link,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36",Accept:"text/html,application/xhtml+xml"},timeout:15e3});html=(null==res?void 0:res.data)||""}const $=cheerio.load(html),title=$("h1.title").first().text().trim()||$("title").first().text().trim()||($("meta[property='og:title']").attr("content")||"").trim();let synopsis=($("meta[name='description']").attr("content")||"").trim()||($("meta[property='og:description']").attr("content")||"").trim()||($(".thecontent").text()||"").slice(0,400).trim();synopsis=synopsis.replace(/^Summary:\s*/i,"").trim();let image=($("meta[property='og:image']").attr("content")||"").trim()||($("meta[name='twitter:image']").attr("content")||"").trim();image||$("script[type='application/ld+json']").each((i,s)=>{try{const txt=$(s).contents().text();if(!txt)return;const parsed=JSON.parse(txt),findUrl=obj=>{if(!obj)return null;if(obj.url&&"string"==typeof obj.url)return obj.url;if(obj.image&&"string"==typeof obj.image)return obj.image;if(Array.isArray(obj))for(const el of obj){const r=findUrl(el);if(r)return r}else if("object"==typeof obj)for(const k of Object.keys(obj)){const r=findUrl(obj[k]);if(r)return r}return null},u=findUrl(parsed);u&&!image&&(image=u)}catch(e){}});const imdbId=(html.match(/tt\d{6,9}/i)||[])[0]||"",catText=($(".thecategory").text()||"")+($("meta[property='article:section']").attr("content")||"");let type=/season|episode|series/i.test(catText+($(".thecontent").text()||""))?"series":"movie";/This is a Movie|This Movie|This is a TV Series|TV Series/i.test($(".thecontent").text()||"")&&(type=/This is a TV Series|TV Series/i.test($(".thecontent").text()||"")?"series":"movie");const links=[];$("h6").each((i,el)=>{const heading=$(el).text().trim(),directLinks=[],fileUrlMatch=heading.match(/https?:\/\/[^>\s]+\.(?:mp4|mkv|avi|webm)/i);fileUrlMatch&&directLinks.push({link:fileUrlMatch[0],title:"Download",type:"movie"});const nextP=$(el).nextAll("p").first();if(nextP&&nextP.length&&nextP.find("a").each((j,ael)=>{const $a=$(ael),href=$a.attr("href")||"";($a.text()||"").trim();href&&!href.toLowerCase().startsWith("javascript:")&&($a.hasClass("maxbutton-oxxfile")?directLinks.push({link:href,title:"Download",type:"movie"}):$a.hasClass("maxbutton-watch-online")&&directLinks.push({link:href,title:"Watch Online",type:"movie"}))}),directLinks.length){const qualityMatch=heading.match(/\b\d{3,4}p\b/i),quality=qualityMatch?qualityMatch[0]:"";links.push({title:heading,episodesLink:"",directLinks:directLinks,quality:quality})}}),$("iframe").each((i,iframe)=>{const src=$(iframe).attr("src");src&&links.push({title:"Stream Player",episodesLink:"",directLinks:[{link:src,title:"Watch Online",type:"movie"}],quality:""})});const seen=new Set,dedupedLinks=links.map(group=>{var _a;const direct=(null!==(_a=group.directLinks)&&void 0!==_a?_a:[]).filter(d=>!(!d||!d.link)&&(!seen.has(d.link)&&(seen.add(d.link),!0)));return{...group,directLinks:direct}}).filter(g=>{var _a;return(null!==(_a=g.directLinks)&&void 0!==_a?_a:[]).length>0}),qualityMap={};dedupedLinks.forEach(g=>{var _a,_b;const watch=null===(_a=g.directLinks.find(d=>d.title.toLowerCase().includes("watch")))||void 0===_a?void 0:_a.link,download=null===(_b=g.directLinks.find(d=>d.title.toLowerCase().includes("download")))||void 0===_b?void 0:_b.link;g.quality&&(qualityMap[g.quality]={watch:watch,download:download})});return{title:title||"",synopsis:synopsis||"",image:image||"",imdbId:imdbId||"",type:type,linkList:dedupedLinks,qualityMap:qualityMap}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]}}};exports.getMeta=getMeta;