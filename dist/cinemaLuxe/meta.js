"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const getMeta=function(_a){return __awaiter(this,arguments,void 0,function*({link:link,providerContext:providerContext}){try{const url=link,res=yield providerContext.axios.get(url,{headers:providerContext.commonHeaders}),$=providerContext.cheerio.load(res.data||"");let title=$("h1.entry-title, h1.post-title, h1, .movie_title, .film-title").first().text().trim()||$("meta[property='og:title']").attr("content")||$("title").text().split("|")[0].trim()||"",synopsis=$("div.synopsis, .summary, .post-content p, .entry-content p, .movie_synopsis").first().text().trim()||$("meta[name='description']").attr("content")||$("meta[property='og:description']").attr("content")||"",image=$("meta[property='og:image']").attr("content")||$("img.wp-post-image").attr("src")||$("img.featured, .poster img, .cover img").attr("src")||$("img").first().attr("src")||"",base="https://cinemalux.run";try{if(providerContext.getBaseUrl){const maybeBase=yield providerContext.getBaseUrl("cinemalux");"string"==typeof maybeBase?base=maybeBase:maybeBase&&"string"==typeof maybeBase.url&&(base=maybeBase.url)}}catch(e){}image&&image.startsWith("/")&&(image=base.replace(/\/$/,"")+image);const tags=[];$("a[rel='tag'], .tags a, .post-categories a, .genres a").each((i,el)=>{const t=$(el).text().trim();t&&tags.push(t)});let rating=$("span.rating, .rating, .imdb, .imdbRatingValue strong, .ratingValue").first().text().trim()||$("meta[itemprop='ratingValue']").attr("content")||"";const ratingMatch=rating.match(/\d+(\.\d+)?/);rating=ratingMatch?ratingMatch[0]:"";const rawLinks=[];$(".download-links a, .download a, .post-content a, a.btn, .links a, .entry-content a, .watch_button a").each((i,el)=>{const $el=$(el);let titleText=$el.text().trim();const href=$el.attr("href");if(!href)return;let quality="";const qMatch=titleText.match(/(\d{3,4}P|4K|HD|1080|720)/i);qMatch&&(quality=qMatch[0].toLowerCase().replace("p","p")),(titleText.includes("Download")||""===titleText)&&(titleText=$el.attr("title")||$el.parent().text().trim()||titleText),rawLinks.push({titleText:titleText,href:href,quality:quality})});const links=rawLinks.map(l=>({title:l.titleText,episodesLink:l.href.startsWith("/")?base.replace(/\/$/,"")+l.href:l.href,quality:l.quality}));return{title:title||"",synopsis:synopsis||"",image:image||"",imdbId:"",type:links.length?"series":"movie",linkList:links,tags:tags,rating:rating}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]}}})};exports.getMeta=getMeta;
