"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPosts=void 0;const getPosts=function(_a){return __awaiter(this,arguments,void 0,function*({filter:filter,query:query,page:page,signal:signal,providerContext:providerContext}){try{let url,baseUrl="https://cinemalux.run";try{if(providerContext.getBaseUrl){const maybeBase=yield providerContext.getBaseUrl("cinemalux");"string"==typeof maybeBase&&maybeBase.startsWith("http")?baseUrl=maybeBase:maybeBase&&"string"==typeof maybeBase.url&&(baseUrl=maybeBase.url)}}catch(err){err instanceof Error?err.message:String(err)}if(query&&query.trim().length>0)url=`${baseUrl.replace(/\/$/,"")}/search/${encodeURIComponent(query)}/`;else{const normalizedFilter=filter||"/";url=normalizedFilter.startsWith("http")||normalizedFilter.startsWith("https")?normalizedFilter:`${baseUrl.replace(/\/$/,"")}${normalizedFilter}${page&&page>1?`page/${page}/`:""}`}const res=yield providerContext.axios.get(url,{headers:providerContext.commonHeaders,signal:signal}),$=providerContext.cheerio.load(res.data||""),catalog=[];return $("article, .result-item, .post, .movie, .item, .thumbnail, .result, .entry").each((i,el)=>{const $el=$(el),a=$el.find("a").first(),title=$el.find("h2").text().trim()||a.attr("title")||a.find("img").attr("alt")||a.text().trim()||$el.find(".title").text().trim();let link=a.attr("href")||a.attr("data-href")||"",image=$el.find("img").attr("data-src")||$el.find("img").attr("src")||$el.find(".poster img").attr("data-src")||$el.find(".poster img").attr("src")||"";link&&link.startsWith("/")&&(link=baseUrl.replace(/\/$/,"")+link),image&&image.startsWith("/")&&(image=baseUrl.replace(/\/$/,"")+image),title&&link&&catalog.push({title:title,link:link,image:image})}),catalog.length||$(".thumbnail, .poster, .result-item").each((i,el)=>{const $el=$(el),title=$el.find("img").attr("alt")||$el.find("h3").text().trim()||$el.find(".title").text().trim();let link=$el.find("a").attr("href")||"",image=$el.find("img").attr("data-src")||$el.find("img").attr("src")||"";link&&link.startsWith("/")&&(link=baseUrl.replace(/\/$/,"")+link),image&&image.startsWith("/")&&(image=baseUrl.replace(/\/$/,"")+image),title&&link&&catalog.push({title:title,link:link,image:image})}),catalog}catch(err){err instanceof Error?err.message:String(err);return[]}})};exports.getPosts=getPosts;
