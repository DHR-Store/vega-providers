"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=async function({link:link,type:type,providerContext:providerContext}){var _a;try{const{axios:axios,cheerio:cheerio}=providerContext,res=await axios.get(link,{headers:{Referer:"https://google.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"}}),$=cheerio.load(res.data),streams=[],excludeServers=["DropGalaxy","DropGalaxy[Instant]","Watch Online"],excludeDomains=["gofile.io","mengaup","vikingfile.com/f/6fdsb9d1tz"],links=$("section[aria-label*='Download'] a[href]").toArray();for(const el of links){const $el=$(el);let href=($el.attr("href")||"").trim(),serverName=($el.text()||"").trim()||"Direct";if(!href)continue;if(href.startsWith("http")||(href=new URL(href,link).href),excludeServers.some(s=>serverName.includes(s)))continue;if(excludeDomains.some(d=>href.includes(d)))continue;if(serverName.includes("V-Cloud"))try{const encodedId=new URLSearchParams(new URL(href,link).search).get("id");if(encodedId){const dlPage=await axios.get(`https://www.fzlinks.xyz/dl.php?id=${encodedId}`,{headers:{Referer:link,"User-Agent":"Mozilla/5.0"}}),$dl=cheerio.load(dlPage.data),directBtn=$dl("a[href] span:contains('Direct Download link')").parent("a").first();if(directBtn.length){const directHref=null===(_a=directBtn.attr("href"))||void 0===_a?void 0:_a.trim();directHref&&streams.push({priority:0,stream:{server:"V-Cloud Direct",link:directHref,type:"file"}})}$dl("div.mt-6 a[href]").each((_,a)=>{var _a;const aEl=$dl(a),realHref=null===(_a=aEl.attr("href"))||void 0===_a?void 0:_a.trim(),text=aEl.find("span").text().trim()||"Direct";if(realHref){let priority=3;text.toLowerCase().includes("direct")?priority=1:text.toLowerCase().includes("pixeldrain")&&(priority=2),streams.push({priority:priority,stream:{server:text,link:realHref,type:"file"}})}});continue}}catch(e){}const sizeMatch=($el.parent().text()||"").match(/\[(.*?)\]/),size=sizeMatch?` [${sizeMatch[1]}]`:"";let priority=3;serverName.toLowerCase().includes("direct")&&(priority=2),streams.push({priority:priority,stream:{server:serverName+size,link:href,type:"file"}})}return streams.sort((a,b)=>a.priority-b.priority).map(s=>s.stream)}catch(err){return[]}};exports.getStream=getStream;