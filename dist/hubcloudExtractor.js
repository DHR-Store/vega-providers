"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var i=e(t),n=0;n<i.length;n++)"default"!==i[n]&&__createBinding(r,t,i[n]);return __setModuleDefault(r,t),r}}(),__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,l){function o(e){try{a(i.next(e))}catch(e){l(e)}}function u(e){try{a(i.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,u)}a((i=i.apply(e,t||[])).next())})},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.hubcloudExtracter=hubcloudExtracter;const axios_1=__importDefault(require("axios")),cheerio=__importStar(require("cheerio")),headers_1=require("./headers"),decode=function(e){return void 0===e?"":atob(e.toString())};function hubcloudExtracter(e,t){return __awaiter(this,void 0,void 0,function*(){var r,i,n,l,o;try{const u=e.split("/").slice(0,3).join("/"),a=[],d=(yield(0,axios_1.default)(`${e}`,{headers:headers_1.headers,signal:t})).data,s=cheerio.load(d),c=d.match(/var\s+url\s*=\s*'([^']+)';/)||[];let f=decode(null===(i=null===(r=c[1])||void 0===r?void 0:r.split("r="))||void 0===i?void 0:i[1])||c[1]||s(".fa-file-download.fa-lg").parent().attr("href")||e;(null==f?void 0:f.startsWith("/"))&&(f=`${u}${f}`);const h=yield fetch(f,{headers:headers_1.headers,signal:t,redirect:"follow"}),v=cheerio.load(yield h.text()),_=v(".btn-success.btn-lg.h6,.btn-danger,.btn-secondary");for(const e of _){let r=v(e).attr("href")||"";if((null==r?void 0:r.includes(".dev"))&&!(null==r?void 0:r.includes("/?id="))&&a.push({server:"Cf Worker",link:r,type:"mkv"}),null==r?void 0:r.includes("pixeld")){if(!(null==r?void 0:r.includes("api"))){const e=r.split("/").pop(),t=r.split("/").slice(0,-2).join("/");r=`${t}/api/file/${e}?download`}a.push({server:"Pixeldrain",link:r,type:"mkv"})}if((null==r?void 0:r.includes("hubcloud"))||(null==r?void 0:r.includes("/?id=")))try{const e=(null===(o=null===(l=null===(n=(yield axios_1.default.head(r,{headers:headers_1.headers,signal:t})).request)||void 0===n?void 0:n.responseURL)||void 0===l?void 0:l.split("link="))||void 0===o?void 0:o[1])||r;a.push({server:"hubcloud",link:e,type:"mkv"})}catch(e){}(null==r?void 0:r.includes("cloudflarestorage"))&&a.push({server:"CfStorage",link:r,type:"mkv"}),(null==r?void 0:r.includes("fastdl"))&&a.push({server:"FastDl",link:r,type:"mkv"}),r.includes("hubcdn")&&a.push({server:"HubCdn",link:r,type:"mkv"})}return a}catch(e){return[]}})}