"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const getMeta=function(_a){return __awaiter(this,arguments,void 0,function*({link:link,providerContext:providerContext}){var _b,_c;try{const{axios:axios,cheerio:cheerio,commonHeaders:commonHeaders,getBaseUrl:getBaseUrl}=providerContext,base=(yield getBaseUrl("HDMovie2"))||"https://hdmovie2.africa",res=yield axios.get(link,{headers:commonHeaders}),$=cheerio.load(res.data||""),title=$("h1.entry-title, h1.post-title, h1").first().text().trim()||$("meta[property='og:title']").attr("content")||$("title").text().split("|")[0].trim()||"",synopsis=$("div.synopsis, .summary, .entry-content p").first().text().trim()||$("meta[name='description']").attr("content")||"";let image=$("meta[property='og:image']").attr("content")||$("img.wp-post-image").attr("src")||$("img.featured, .poster img, .cover img").attr("src")||"";image.startsWith("/")&&(image=base+image);const tags=[];$("a[rel='tag'], .tags a, .post-categories a, .genres a").each((i,el)=>{const t=$(el).text().trim();t&&tags.push(t)});const ratingMatch=($("span.rating, .rating, .imdb, .imdbRatingValue strong, .ratingValue").first().text().trim()||$("meta[itemprop='ratingValue']").attr("content")||"").match(/\d+(\.\d+)?/),rating=ratingMatch?ratingMatch[0]:"",imdbId=(null===(_c=null===(_b=$("a[href*='imdb.com/title/tt']").attr("href"))||void 0===_b?void 0:_b.split("/tt")[1])||void 0===_c?void 0:_c.split("/")[0])||"",linkList=[],allLinks=[];$("a, button").each((_,el)=>{const $el=$(el);let href=$el.attr("href")||$el.data("href")||"";const lowerText=$el.text().trim().toLowerCase();if(!href||href.startsWith("#")||href.startsWith("javascript:void(0)"))return;href.startsWith("/")&&(href=base+href);const qualityMatch=lowerText.match(/\d{3,4}p|4k|hd/),quality=qualityMatch?qualityMatch[0].toUpperCase():"auto";lowerText.includes("play")||lowerText.includes("stream")?allLinks.push({title:"Play",link:href,type:"movie",quality:quality}):lowerText.includes("download")&&allLinks.push({title:"Download",link:href,type:"movie",quality:quality})});const isSeries=$(".episodios li, .episode-list li, .episodes li").length>0;if(isSeries){const episodeLinkMap={};$(".episodios li a, .episode-list li a, .episodes li a").each((i,el)=>{const $el=$(el);let href=$el.attr("href")||"";const lowerText=$el.text().trim().toLowerCase();if(!href)return;href.startsWith("/")&&(href=base+href);const qualityMatch=lowerText.match(/\d{3,4}p|4k|hd/),quality=qualityMatch?qualityMatch[0].toUpperCase():"auto",epTitle=$el.text().trim()||`Episode ${i+1}`;episodeLinkMap[epTitle]||(episodeLinkMap[epTitle]=[]),lowerText.includes("play")||lowerText.includes("stream")?episodeLinkMap[epTitle].push({title:"Play",link:href,type:"episode",quality:quality}):lowerText.includes("download")?episodeLinkMap[epTitle].push({title:"Download",link:href,type:"episode",quality:quality}):episodeLinkMap[epTitle].push({title:"Play",link:href,type:"episode",quality:quality})});for(const[epTitle,links]of Object.entries(episodeLinkMap))links&&links.length>0&&linkList.push({title:epTitle,directLinks:links})}else allLinks.length>0?linkList.push({title:title||"Movie",directLinks:allLinks}):linkList.push({title:"Play",directLinks:[{title:"Play",link:link,type:"movie",quality:"auto"}]});return{title:title,synopsis:synopsis,image:image,imdbId:imdbId,type:isSeries?"series":"movie",linkList:linkList,tags:tags,rating:rating}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[],tags:[],rating:""}}})};exports.getMeta=getMeta;
